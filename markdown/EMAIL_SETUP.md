# üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ Supabase

## –û–±–∑–æ—Ä

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Supabase.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Supabase Dashboard

### 1. –í–∫–ª—é—á–∏—Ç—å Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Providers**
4. –ù–∞–π–¥–∏—Ç–µ **Email** –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
5. –ù–∞–∂–º–∏—Ç–µ **Edit**
6. –í–∫–ª—é—á–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
   - ‚úÖ **Enable Email provider**
   - ‚úÖ **Confirm email** (–¢—Ä–µ–±–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email)

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Email —à–∞–±–ª–æ–Ω—ã

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Email Templates**

2. –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω **"Confirm signup"**

3. –ò–∑–º–µ–Ω–∏—Ç–µ —Ç–∏–ø –Ω–∞ **"Magic Link"** –∏–ª–∏ **"OTP"**:

#### –î–ª—è OTP (6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥) - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

–í –ø–æ–ª–µ **Message (Body)**:

```html
<h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à email</h2>

<p>–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é!</p>

<p>–í–∞—à –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</p>

<h1 style="font-size: 32px; font-weight: bold; color: #4F46E5;">{{ .Token }}</h1>

<p>–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.</p>

<p>–ï—Å–ª–∏ –≤—ã –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
```

**Subject**: `–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à email - CrushVerse`

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Email-—Å–µ—Ä–≤–µ—Ä (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SMTP —Å–µ—Ä–≤–µ—Ä (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 3 –ø–∏—Å—å–º–∞ –≤ —á–∞—Å).

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π SMTP:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Project Settings** ‚Üí **Auth**
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **SMTP Settings**
3. –í–∫–ª—é—á–∏—Ç–µ **Enable Custom SMTP**
4. –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ SMTP:
   - **Host**: –Ω–∞–ø—Ä–∏–º–µ—Ä, `smtp.gmail.com`
   - **Port**: `587` (–∏–ª–∏ `465` –¥–ª—è SSL)
   - **Username**: –≤–∞—à email
   - **Password**: –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - **Sender Email**: –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `noreply@yourapp.com`)
   - **Sender Name**: –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CrushVerse`)

#### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ SMTP –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:

- **Gmail**: `smtp.gmail.com:587` (—Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- **SendGrid**: `smtp.sendgrid.net:587`
- **Mailgun**: `smtp.mailgun.org:587`
- **AWS SES**: `email-smtp.{region}.amazonaws.com:587`

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–í **Authentication** ‚Üí **Policies** —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:

- ‚úÖ Email confirmation required
- ‚úÖ Disable signup (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –≤–æ–π—Ç–∏)

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```dart
final result = await AuthService.signUpWithEmail(
  email: 'user@example.com',
  password: 'password123',
  nickname: 'cooluser',
);
```

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email, –ø–∞—Ä–æ–ª—å –∏ –Ω–∏–∫–Ω–µ–π–º
- Supabase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ email
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —ç–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –∫–æ–¥–∞

### 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞

```dart
final result = await AuthService.verifyEmailWithOTP(
  email: 'user@example.com',
  token: '123456',
);
```

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

### 3. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

```dart
await AuthService.resendVerificationCode(
  email: 'user@example.com',
);
```

- –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –ø—Ä–∏—à–µ–ª, –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –≠–∫—Ä–∞–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

1. **LoginScreen** - —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
2. **RegisterScreen** - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **VerifyEmailScreen** - –≤–≤–æ–¥ 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### –ù–∞–≤–∏–≥–∞—Ü–∏—è:

```
LoginScreen ‚Üí [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è] ‚Üí RegisterScreen ‚Üí [–£—Å–ø–µ—Ö] ‚Üí VerifyEmailScreen ‚Üí [–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ] ‚Üí LoginScreen
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Supabase:

1. **Rate Limiting**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Rate Limits**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ —á–∞—Å)

2. **Password Requirements**:
   - –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ **Auth** ‚Üí **Policies**

3. **OTP Settings**:
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞: 24 —á–∞—Å–∞
   - –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ **Auth** ‚Üí **Email Templates**

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π SMTP Supabase

- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 3 –ø–∏—Å—å–º–∞ –≤ —á–∞—Å –Ω–∞ email
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Å–ø–∞–º
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ö–∞—Å—Ç–æ–º–Ω—ã–π SMTP

- ‚úÖ –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
- ‚úÖ –õ—É—á—à–∞—è –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å
- ‚úÖ –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 3. –î–ª—è Production

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–π SMTP —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω –¥–ª—è email
- ‚úÖ SPF, DKIM –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
- ‚úÖ Rate limiting

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ SMTP (3 –ø–∏—Å—å–º–∞/—á–∞—Å)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Supabase Dashboard ‚Üí **Logs**
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π SMTP

### –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥

1. –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 24 —á–∞—Å–∞
2. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ —Å—Ä–æ–∫

### –û—à–∏–±–∫–∞ "Email already registered"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω:
1. –í–æ–π–¥–∏—Ç–µ —Å —ç—Ç–∏–º email –∏ –ø–∞—Ä–æ–ª–µ–º
2. –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email:

1. **Dashboard** ‚Üí **Logs**
2. –§–∏–ª—å—Ç—Ä: `auth.otp`
3. –°–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **Authentication** ‚Üí **Users**
2. –°—Ç–æ–ª–±–µ—Ü **Email Confirmed** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω email:

1. **Authentication** ‚Üí **Email Templates**
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ HTML –≤ **Message (Body)**
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   - `{{ .Token }}` - –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - `{{ .Email }}` - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `{{ .SiteURL }}` - URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞

### –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞:

–í SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è OTP 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
ALTER TABLE auth.users 
SET COLUMN confirmation_sent_at 
DEFAULT (now() - interval '1 hour');
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ email —Å –∫–æ–¥–æ–º
3. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ –í—Ö–æ–¥ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìù –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞! üéâ

