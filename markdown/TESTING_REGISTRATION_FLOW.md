# Тестирование потока регистрации

## Обновленная логика

Теперь регистрация работает следующим образом:

1. **Пользователь заполняет форму регистрации** → данные сохраняются во временном хранилище
2. **Отправляется код подтверждения на email** → пользователь переходит на экран подтверждения
3. **Пользователь вводит код** → данные записываются в базу данных Supabase
4. **Переход на главную страницу** → регистрация завершена

## Как протестировать

### 1. Запустите приложение
```bash
flutter run
```

### 2. Протестируйте регистрацию
1. Нажмите "Зарегистрироваться"
2. Заполните форму (никнейм, email, пароль)
3. Нажмите "Зарегистрироваться"
4. Проверьте консоль на наличие логов:
   - `AuthService: Начинаем регистрацию для...`
   - `EmailService: Начинаем отправку кода на...`
   - `EmailService: Письмо успешно отправлено` (если email работает)

### 3. Подтвердите email
1. Введите 6-значный код из письма
2. Нажмите "Подтвердить"
3. Проверьте консоль:
   - `AuthService: Создаем пользователя в Supabase после подтверждения email`
   - `AuthService: Пользователь успешно создан в Supabase, ID: ...`
4. Должен произойти переход на главную страницу

### 4. Проверьте базу данных
1. Откройте Supabase Dashboard
2. Перейдите в раздел "Table Editor"
3. Выберите таблицу "users"
4. Убедитесь, что новый пользователь появился в таблице

## Возможные проблемы

### Email не отправляется
- Проверьте настройки в `lib/config/email_config.dart`
- Убедитесь, что используете правильный пароль приложения
- Проверьте логи в консоли

### Пользователь не создается в БД
- Проверьте, что триггер `handle_new_user()` работает в Supabase
- Убедитесь, что миграция `001_create_users_table.sql` применена
- Проверьте логи в консоли

### Не происходит переход на главную страницу
- Проверьте, что `MainScreen` импортирован правильно
- Убедитесь, что `result.success` возвращает `true`

## Логи для отладки

В консоли должны появиться следующие сообщения:

```
AuthService: Начинаем регистрацию для test@example.com
AuthService: Проверяем существование пользователя
AuthService: Сохраняем данные пользователя
EmailService: Начинаем отправку кода на test@example.com
EmailService: Сгенерирован код: 123456
EmailService: Настраиваем SMTP сервер
EmailService: Отправляем письмо...
EmailService: Письмо успешно отправлено
AuthService: Регистрация успешна, требуется подтверждение email
```

При подтверждении:
```
AuthService: Подтверждение email для test@example.com
AuthService: Создаем пользователя в Supabase после подтверждения email
AuthService: Пользователь успешно создан в Supabase, ID: xxx-xxx-xxx
```
